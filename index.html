<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Pixel Legacy</title>
    <!-- Tailwind CSS CDN ë¡œë“œ -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* í”½ì…€ ì•„íŠ¸ë¥¼ ìœ„í•œ í•„ìˆ˜ CSS ì†ì„± */
        .image-rendering-crisp {
            image-rendering: pixelated;
            image-rendering: -moz-crisp-edges;
            image-rendering: -webkit-optimize-contrast;
        }
    </style>
    <!-- React, ReactDOM, Babel UMD ë¡œë“œ -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body class="bg-gray-900">

    <div id="root"></div>

    <!-- Firebase SDK ë¡œë“œ -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
        import { 
            getFirestore, doc, onSnapshot, collection, runTransaction, setDoc, query 
        } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
        
        // ì „ì—­ìœ¼ë¡œ ì‚¬ìš©í•  Firebase ê°ì²´ë¥¼ windowì— í• ë‹¹
        window.firebaseDependencies = {
            initializeApp,
            getAuth, signInAnonymously, onAuthStateChanged,
            getFirestore, doc, onSnapshot, collection, runTransaction, setDoc, query
        };
    </script>

    <!-- JSX ì½”ë“œëŠ” type="text/babel" ìŠ¤í¬ë¦½íŠ¸ íƒœê·¸ ì•ˆì— ë„£ëŠ”ë‹¤ -->
    <script type="text/babel">
        const { useState, useEffect, useCallback, useRef, useMemo } = React;
        const { initializeApp, getAuth, signInAnonymously, onAuthStateChanged, getFirestore, doc, onSnapshot, collection, runTransaction, setDoc, query } = window.firebaseDependencies;

        // --- ì „ì—­ ì„¤ì • ë° ìƒìˆ˜ ---
        const CANVAS_SIZE = 1024;
        const CHUNK_SIZE = 32;    
        const CHUNK_COUNT = CANVAS_SIZE / CHUNK_SIZE; 
        const COOLDOWN_SECONDS = 300; 

        const PIXEL_CHUNKS_PATH = 'canvas_data/public_canvas/chunks';
        const USER_STATUS_PATH = 'canvas_data/user_status';

        const BASE_PALETTE = [
          '#000000', '#FFFFFF', '#FF0000', '#00FF00', '#0000FF', '#FFFF00', '#00FFFF', '#FF00FF',
          '#C0C0C0', '#808080', '#800000', '#808000', '#008000', '#800080', '#008080', '#000080',
          '#404040', '#BFBFBF', '#A00000', '#A0A000', '#00A000', '#A000A0', '#00A0A0', '#0000A0',
          '#7F0000', '#7F7F00', '#007F00', '#7F007F', '#007F7F', '#00007F', '#3F0000', '#3F3F00',
          '#003F00', '#3F003F', '#003F3F', '#00003F', '#FF4040', '#40FF40', '#4040FF', '#FFFF40',
          '#40FFFF', '#FF40FF', '#A04040', '#40A040', '#4040A0', '#A0A040', '#40A0A0', '#A040A0',
        ];
        const PALETTE = [
          ...BASE_PALETTE,
          ...Array(256 - BASE_PALETTE.length).fill(null).map((_, i) => {
            const r = ((i * 15 + 100) % 256).toString(16).padStart(2, '0');
            const g = ((i * 10 + 150) % 256).toString(16).padStart(2, '0');
            const b = ((i * 5 + 50) % 256).toString(16).padStart(2, '0');
            return `#${r.slice(0, 2)}${g.slice(0, 2)}${b.slice(0, 2)}`;
          }),
        ].slice(0, 256); 

        // Base64 ë¬¸ìì—´ì„ Uint8Arrayë¡œ ë””ì½”ë”©
        const decodeBase64 = (base64) => {
          if (!base64) return new Uint8Array(CHUNK_SIZE * CHUNK_SIZE).fill(0);
          try {
            const binaryString = atob(base64);
            const len = binaryString.length;
            const bytes = new Uint8Array(len);
            for (let i = 0; i < len; i++) {
              bytes[i] = binaryString.charCodeAt(i);
            }
            return bytes;
          } catch (e) {
            console.error("Base64 ë””ì½”ë”© ì˜¤ë¥˜:", e);
            return new Uint8Array(CHUNK_SIZE * CHUNK_SIZE).fill(0);
          }
        };

        // Uint8Arrayë¥¼ Base64 ë¬¸ìì—´ë¡œ ì¸ì½”ë”©
        const encodeBase64 = (uint8Array) => {
          try {
            let binary = '';
            uint8Array.forEach(byte => {
              binary += String.fromCharCode(byte);
            });
            return btoa(binary);
          } catch (e) {
            console.error("Base64 ì¸ì½”ë”© ì˜¤ë¥˜:", e);
            return '';
          }
        };

        // ë©”ì¸ App ì»´í¬ë„ŒíŠ¸
        const App = () => {
          const [db, setDb] = useState(null);
          const [userId, setUserId] = useState(null);
          const [isAuthReady, setIsAuthReady] = useState(false);
          const [initError, setInitError] = useState(null); 

          const [userConfig, setUserConfig] = useState(null);
          const [showConfigModal, setShowConfigModal] = useState(true); // í•­ìƒ ëª¨ë‹¬ë¡œ ì‹œì‘

          const [pixelData, setPixelData] = useState({}); 
          const [selectedColorIndex, setSelectedColorIndex] = useState(1); 
          const [nextClickTime, setNextClickTime] = useState(0);
          const [remainingCooldown, setRemainingCooldown] = useState(0);
          const [message, setMessage] = useState(null);

          const canvasRef = useRef(null);
          
          // 1-1. config ë¡œë“œ (localStorage ìš°ì„ )
          useEffect(() => {
            const savedConfig = localStorage.getItem('firebaseConfig');
            if (savedConfig) {
                try {
                    const config = JSON.parse(savedConfig);
                    // configì— í•„ìˆ˜ í•„ë“œê°€ ìˆëŠ”ì§€ í™•ì¸
                    if (config.apiKey && config.projectId && config.appId) {
                       setUserConfig(config);
                       setShowConfigModal(false);
                    } else {
                        throw new Error("Missing required config fields.");
                    }
                } catch (e) {
                    console.error("Saved config parse failed or invalid. Resetting.", e);
                    localStorage.removeItem('firebaseConfig');
                }
            } 
          }, []);

          // 1-2. Firebase ì´ˆê¸°í™”
          useEffect(() => {
            if (!userConfig || db) return;

            const initializeFirebase = async () => {
              try {
                if (Object.keys(userConfig).length === 0) {
                    throw new Error("Firebase config is empty.");
                }
                
                const app = initializeApp(userConfig);
                const firestore = getFirestore(app);
                const firebaseAuth = getAuth(app);
                
                setDb(firestore);

                await signInAnonymously(firebaseAuth);

                const unsubscribe = onAuthStateChanged(firebaseAuth, (user) => {
                  if (user) {
                    setUserId(user.uid);
                  } else {
                    setUserId(null);
                  }
                  setIsAuthReady(true);
                });

                return () => unsubscribe();

              } catch (e) {
                console.error("Firebase ì´ˆê¸°í™” ì¤‘ ì‹¬ê°í•œ ì˜¤ë¥˜ ë°œìƒ:", e);
                setInitError(`ì´ˆê¸°í™” ì‹¤íŒ¨: ${e.message}. ì„¤ì •ì„ í™•ì¸í•˜ì„¸ìš”.`);
                setIsAuthReady(true); 
                setUserConfig(null); 
                localStorage.removeItem('firebaseConfig');
                setShowConfigModal(true);
              }
            };
            initializeFirebase();
          }, [userConfig]); 

          // 2. ì¿¨ë‹¤ìš´ ìƒíƒœ ë¡œë“œ ë° íƒ€ì´ë¨¸ ì„¤ì •
          useEffect(() => {
            if (!db || !userId) return;

            const userDocRef = doc(db, USER_STATUS_PATH, userId);

            const unsubscribe = onSnapshot(userDocRef, (docSnap) => {
              if (docSnap.exists()) {
                const data = docSnap.data();
                const lastClick = data.lastClick?.toMillis() || 0; 
                setNextClickTime(lastClick + COOLDOWN_SECONDS * 1000);
              } else {
                setDoc(userDocRef, { lastClick: new Date(0) });
                setNextClickTime(0);
              }
            }, (error) => {
              console.error("ì¿¨ë‹¤ìš´ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:", error);
            });

            const timer = setInterval(() => {
              const remaining = Math.max(0, Math.ceil((nextClickTime - Date.now()) / 1000));
              setRemainingCooldown(remaining);
            }, 1000);

            return () => {
              unsubscribe();
              clearInterval(timer);
            };
          }, [db, userId, nextClickTime]);

          // 3. ìº”ë²„ìŠ¤ ë°ì´í„° (ì²­í¬) ì‹¤ì‹œê°„ ë¡œë“œ ë° êµ¬ë…
          useEffect(() => {
            if (!db || !isAuthReady) return;

            const chunksColRef = collection(db, PIXEL_CHUNKS_PATH);
            const q = query(chunksColRef);

            const unsubscribe = onSnapshot(q, (querySnapshot) => {
              const newPixelData = {};
              querySnapshot.forEach((doc) => {
                const chunkId = doc.id;
                const data = doc.data();
                const pixels = decodeBase64(data.pixels);
                newPixelData[chunkId] = pixels;
              });
              
              for (let r = 0; r < CHUNK_COUNT; r++) {
                for (let c = 0; c < CHUNK_COUNT; c++) {
                  const chunkId = `chunk_${r}_${c}`;
                  if (!newPixelData[chunkId]) {
                    newPixelData[chunkId] = new Uint8Array(CHUNK_SIZE * CHUNK_SIZE).fill(0);
                  }
                }
              }
              setPixelData(newPixelData);

            }, (error) => {
              console.error("ìº”ë²„ìŠ¤ ë°ì´í„° ë™ê¸°í™” ì‹¤íŒ¨:", error);
              setMessage({ type: 'error', text: 'ìº”ë²„ìŠ¤ ë°ì´í„° ë™ê¸°í™”ì— ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.' });
            });

            return () => unsubscribe();
          }, [db, isAuthReady]);

          // 4. ìº”ë²„ìŠ¤ ë Œë”ë§
          useEffect(() => {
            const canvas = canvasRef.current;
            if (!canvas) return;

            const ctx = canvas.getContext('2d');
            
            canvas.width = CANVAS_SIZE;
            canvas.height = CANVAS_SIZE;

            ctx.fillStyle = PALETTE[0]; 
            ctx.fillRect(0, 0, CANVAS_SIZE, CANVAS_SIZE);

            for (let chunkR = 0; chunkR < CHUNK_COUNT; chunkR++) {
              for (let chunkC = 0; chunkC < CHUNK_COUNT; chunkC++) {
                const chunkId = `chunk_${chunkR}_${chunkC}`;
                const chunkPixels = pixelData[chunkId];

                if (chunkPixels) {
                  for (let i = 0; i < CHUNK_SIZE; i++) { 
                    for (let j = 0; j < CHUNK_SIZE; j++) { 
                      const pixelIndex = i * CHUNK_SIZE + j;
                      const colorIndex = chunkPixels[pixelIndex];
                      
                      if (colorIndex !== 0) { 
                        ctx.fillStyle = PALETTE[colorIndex];
                        
                        const x = chunkC * CHUNK_SIZE + j;
                        const y = chunkR * CHUNK_SIZE + i;
                        
                        ctx.fillRect(x, y, 1, 1); 
                      }
                    }
                  }
                }
              }
            }
          }, [pixelData]); 

          // 5. í”½ì…€ í´ë¦­ ì²˜ë¦¬
          const handlePixelClick = useCallback(async (event) => {
            if (remainingCooldown > 0) {
              setMessage({ type: 'warning', text: `ì¿¨ë‹¤ìš´(${formatTime(remainingCooldown)} ë‚¨ìŒ)! 5ë¶„ ë’¤ì— ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”.` });
              return;
            }
            if (!db || !userId) {
              setMessage({ type: 'error', text: 'ì¸ì¦ ì¤‘ì…ë‹ˆë‹¤. ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.' });
              return;
            }

            const canvas = canvasRef.current;
            if (!canvas) return;

            const rect = canvas.getBoundingClientRect();
            const scaleX = canvas.width / rect.width;
            const scaleY = canvas.height / rect.height;

            const pixelX = Math.floor((event.clientX - rect.left) * scaleX);
            const pixelY = Math.floor((event.clientY - rect.top) * scaleY);

            if (pixelX < 0 || pixelX >= CANVAS_SIZE || pixelY < 0 || pixelY >= CANVAS_SIZE) return;

            const chunkR = Math.floor(pixelY / CHUNK_SIZE);
            const chunkC = Math.floor(pixelX / CHUNK_SIZE);
            const chunkId = `chunk_${chunkR}_${chunkC}`;
            
            const pixelRInChunk = pixelY % CHUNK_SIZE;
            const pixelCInChunk = pixelX % CHUNK_SIZE;
            const pixelIndexInChunk = pixelRInChunk * CHUNK_SIZE + pixelCInChunk;

            const chunkRef = doc(db, PIXEL_CHUNKS_PATH, chunkId);
            const userStatusRef = doc(db, USER_STATUS_PATH, userId);
            const newColorIndex = selectedColorIndex;

            try {
              await runTransaction(db, async (transaction) => {
                const userStatusSnap = await transaction.get(userStatusRef);
                const userData = userStatusSnap.data() || { lastClick: new Date(0) };
                const lastClickTime = userData.lastClick?.toMillis() || 0;
                
                if (Date.now() < lastClickTime + COOLDOWN_SECONDS * 1000) {
                  throw new Error('cooldown');
                }

                const chunkSnap = await transaction.get(chunkRef);
                let currentPixels;
                if (chunkSnap.exists()) {
                  const base64 = chunkSnap.data().pixels;
                  currentPixels = decodeBase64(base64);
                } else {
                  currentPixels = new Uint8Array(CHUNK_SIZE * CHUNK_SIZE).fill(0);
                }

                currentPixels[pixelIndexInChunk] = newColorIndex;
                const newBase64 = encodeBase64(currentPixels);

                transaction.set(chunkRef, { 
                  pixels: newBase64, 
                  lastUpdated: new Date() 
                }, { merge: true });
                
                transaction.set(userStatusRef, { 
                  lastClick: new Date() 
                }, { merge: true });
              });

              setMessage({ type: 'success', text: 'í”½ì…€ì„ ì„±ê³µì ìœ¼ë¡œ ì¹ í–ˆìŠµë‹ˆë‹¤! 5ë¶„ ì¿¨ë‹¤ìš´ ì‹œì‘.' });
              
            } catch (e) {
              if (e.message === 'cooldown') {
                const remaining = Math.max(0, Math.ceil((nextClickTime - Date.now()) / 1000));
                setMessage({ type: 'warning', text: `ì¿¨ë‹¤ìš´(${formatTime(remaining)} ë‚¨ìŒ)! ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”.` });
              } else {
                console.error("í”½ì…€ ì—…ë°ì´íŠ¸ íŠ¸ëœì­ì…˜ ì‹¤íŒ¨:", e);
                setMessage({ type: 'error', text: `í”½ì…€ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨: ${e.message}` });
              }
            }
          }, [db, userId, selectedColorIndex, remainingCooldown, nextClickTime]);

          // ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜
          const formatTime = (seconds) => {
            const minutes = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
          };
          
          useEffect(() => {
            if (message) {
              const timer = setTimeout(() => setMessage(null), 5000);
              return () => clearTimeout(timer);
            }
          }, [message]);

          const currentUserIdDisplay = useMemo(() => {
            if (!userId) return 'ì¸ì¦ ì¤‘...';
            return userId;
          }, [userId]);


          // --- ì„¤ì • ëª¨ë‹¬ ì»´í¬ë„ŒíŠ¸ ---
          const ConfigurationModal = () => {
            const [jsonInput, setJsonInput] = useState('');
            const [error, setError] = useState('');

            const handleSubmit = (e) => {
                e.preventDefault();
                setError('');
                try {
                    const config = JSON.parse(jsonInput);
                    if (!config.apiKey || !config.projectId || !config.appId) {
                        throw new Error("apiKey, projectId, appId í•„ë“œê°€ í•„ìš”í•©ë‹ˆë‹¤.");
                    }

                    localStorage.setItem('firebaseConfig', JSON.stringify(config));
                    setUserConfig(config);
                    setShowConfigModal(false);
                    setError('');

                } catch (e) {
                    setError(`ì„¤ì • ì˜¤ë¥˜: ìœ íš¨í•œ Firebase JSON í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤. (${e.message})`);
                }
            };
            
            const handleReset = () => {
                localStorage.removeItem('firebaseConfig');
                setUserConfig(null);
                setJsonInput('');
                setError('');
            }

            return (
                <div className="fixed inset-0 z-50 flex items-center justify-center bg-gray-900 bg-opacity-95 p-4">
                    <div className="bg-gray-800 p-6 md:p-10 rounded-xl shadow-2xl w-full max-w-lg">
                        <h2 className="text-2xl font-bold text-pink-400 mb-4">
                            ğŸ› ï¸ Firebase ì„¤ì • (GitHub Pagesìš©)
                        </h2>
                        <p className="text-gray-300 mb-4 text-sm">
                            ì´ ê²Œì„ì„ ì‹œì‘í•˜ë ¤ë©´, ë„¤ Firebase í”„ë¡œì íŠ¸ ì„¤ì •ì´ í•„ìš”í•´.
                        </p>
                        <ol className="list-decimal list-inside text-gray-400 text-xs mb-4 p-3 bg-gray-900 rounded">
                            <li>Firebase ì½˜ì†”ì—ì„œ **ì›¹ ì•± ì„¤ì • JSON**ì„ ë³µì‚¬í•´.</li>
                            <li>Firestoreì˜ **ë³´ì•ˆ ê·œì¹™**ì„ ì—´ê³ , ë‹¤ìŒ ê²½ë¡œë¥¼ í—ˆìš©í•˜ë„ë¡ ì„¤ì •í•´ì•¼ í•´:</li>
                            <li className="ml-2 font-mono text-xs text-gray-500">
                                /{PIXEL_CHUNKS_PATH}/... <br/>
                                /{USER_STATUS_PATH}/{request.auth.uid}
                            </li>
                        </ol>
                        
                        <form onSubmit={handleSubmit}>
                            <label htmlFor="firebase-json" className="block text-sm font-medium text-gray-300 mb-2">
                                Firebase Config JSON:
                            </label>
                            <textarea
                                id="firebase-json"
                                rows="6"
                                className="w-full bg-gray-900 border border-gray-700 text-gray-100 p-3 rounded-lg font-mono text-sm resize-none focus:ring-pink-500 focus:border-pink-500"
                                placeholder={`{
  "apiKey": "AIza...",
  "authDomain": "...",
  "projectId": "your-project-id",
  // ... (ë‚˜ë¨¸ì§€ í•„ë“œ)
}`}
                                value={jsonInput}
                                onChange={(e) => setJsonInput(e.target.value)}
                                required
                            />
                            {error && (
                                <p className="text-red-400 text-xs mt-2">{error}</p>
                            )}
                            <button
                                type="submit"
                                className="mt-4 w-full bg-pink-600 hover:bg-pink-700 text-white font-bold py-2 rounded-lg transition duration-200 shadow-lg shadow-pink-500/50"
                            >
                                ì„¤ì • ì €ì¥ ë° ê²Œì„ ì‹œì‘
                            </button>
                            <button
                                type="button"
                                onClick={handleReset}
                                className="mt-2 w-full bg-gray-600 hover:bg-gray-700 text-white text-sm py-1 rounded-lg transition duration-200"
                            >
                                ì„¤ì • ì´ˆê¸°í™”
                            </button>
                        </form>
                    </div>
                </div>
            );
          };

          // --- ë©”ì¸ ë Œë”ë§ ---

          if (showConfigModal && !userConfig) {
              return <ConfigurationModal />;
          }
          
          if (initError) {
              const handleReset = () => {
                  localStorage.removeItem('firebaseConfig');
                  setInitError(null);
                  setUserConfig(null);
                  setShowConfigModal(true);
              };

              return (
                <div className="flex flex-col items-center justify-center min-h-screen bg-red-900 text-white p-8">
                  <h1 className="text-3xl font-bold mb-4">ğŸš¨ ì´ˆê¸°í™” ì˜¤ë¥˜</h1>
                  <p className="text-lg text-red-300 mb-6">Firebase ì„¤ì • ë˜ëŠ” ì—°ê²°ì— ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p>
                  <pre className="p-4 bg-red-800 rounded-lg text-sm text-left whitespace-pre-wrap w-full max-w-md">
                    {initError}
                  </pre>
                  <button 
                      onClick={handleReset}
                      className="mt-6 bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded-lg transition duration-200"
                  >
                      ì„¤ì • ë‹¤ì‹œ ì…ë ¥
                  </button>
                </div>
              );
          }

          if (!isAuthReady) {
            return (
              <div className="flex items-center justify-center min-h-screen bg-gray-900 text-white">
                <div className="text-xl animate-pulse">ì¸ì¦ ë° ë°ì´í„° ë¡œë”© ì¤‘...</div>
              </div>
            );
          }

          return (
            <div 
              className="min-h-screen bg-gray-900 text-white p-4 md:p-8 flex flex-col items-center font-sans"
              style={{ fontFamily: 'Inter, sans-serif' }}
            >
              <div className="w-full max-w-5xl">
                {/* í—¤ë” ë° ìƒíƒœ */}
                <header className="text-center mb-6">
                  <h1 className="text-4xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-pink-600">
                    The Pixel Legacy ğŸ–¼ï¸
                  </h1>
                  <p className="text-sm text-gray-400 mt-1">
                    ìœ ì¼í•œ 1024x1024 ìº”ë²„ìŠ¤ì— í”½ì…€ ìœ ì‚°ì„ ë‚¨ê²¨ë¼.
                  </p>
                  <div className="mt-2 p-2 bg-gray-800 rounded-lg text-xs text-gray-300">
                    ë‹¹ì‹ ì˜ ID: <span className="font-mono text-pink-400 break-all">{currentUserIdDisplay}</span>
                  </div>
                </header>

                {/* ë©”ì‹œì§€ ë°•ìŠ¤ */}
                {message && (
                  <div 
                    className={`p-3 mb-4 rounded-lg text-center font-medium ${
                      message.type === 'error' ? 'bg-red-700 text-white' : 
                      message.type === 'warning' ? 'bg-yellow-800 text-yellow-300' :
                      'bg-green-700 text-white' 
                    } shadow-lg`}
                  >
                    {message.text}
                  </div>
                )}

                {/* ì»¨íŠ¸ë¡¤ íŒ¨ë„ */}
                <div className="bg-gray-800 p-4 rounded-xl shadow-2xl mb-6 w-full">
                  <h2 className="text-xl font-semibold mb-3 border-b border-gray-700 pb-2 text-purple-300">
                    í”½ì…€ ì»¨íŠ¸ë¡¤
                  </h2>

                  {/* ì¿¨ë‹¤ìš´ íƒ€ì´ë¨¸ */}
                  <div className="flex justify-between items-center mb-4">
                    <span className="text-sm text-gray-300">ë‹¤ìŒ í´ë¦­ ê°€ëŠ¥ ì‹œê°„:</span>
                    <span 
                      className={`text-2xl font-mono px-3 py-1 rounded-md transition-colors duration-500 ${
                        remainingCooldown > 0 
                          ? 'bg-red-700 text-white animate-pulse shadow-red-500/50 shadow-md' 
                          : 'bg-green-600 text-white shadow-green-500/50 shadow-md'
                      }`}
                    >
                      {remainingCooldown > 0 ? formatTime(remainingCooldown) : 'READY'}
                    </span>
                  </div>

                  {/* ìƒ‰ìƒ íŒ”ë ˆíŠ¸ */}
                  <div className="mb-4">
                    <h3 className="text-sm font-medium mb-2 text-gray-300">ì„ íƒëœ ìƒ‰ìƒ: </h3>
                    <div className="flex items-center space-x-3">
                      <div 
                        className="w-8 h-8 rounded-full border-4 shadow-xl"
                        style={{ backgroundColor: PALETTE[selectedColorIndex], borderColor: '#fff' }}
                      ></div>
                      <span className="font-mono text-lg text-pink-400">{PALETTE[selectedColorIndex]}</span>
                    </div>
                    
                    <div className="grid grid-cols-8 sm:grid-cols-16 gap-1 mt-3 max-h-48 overflow-y-auto p-1 border border-gray-700 rounded-lg bg-gray-900/50">
                      {PALETTE.map((color, index) => (
                        <div 
                          key={index}
                          className={`w-6 h-6 rounded-sm cursor-pointer transition-transform duration-100 ease-in-out ${
                            selectedColorIndex === index ? 'ring-2 ring-offset-2 ring-pink-500 ring-offset-gray-900 scale-110' : 'hover:scale-105'
                          }`}
                          style={{ backgroundColor: color }}
                          onClick={() => setSelectedColorIndex(index)}
                          title={color}
                        ></div>
                      ))}
                    </div>
                  </div>
                </div>

                {/* ìº”ë²„ìŠ¤ ì˜ì—­ */}
                <div className="w-full aspect-square border-4 border-purple-500 rounded-xl overflow-hidden shadow-2xl shadow-purple-500/30 bg-gray-800">
                  <canvas
                    ref={canvasRef}
                    onClick={handlePixelClick}
                    className="w-full h-full cursor-crosshair image-rendering-crisp"
                    style={{ imageRendering: 'pixelated' }}
                  />
                </div>

                {/* í‘¸í„° ë° ì„¤ëª… */}
                <footer className="mt-8 text-center text-sm text-gray-500">
                  <p>
                    **ì£¼ì˜:** ì´ ê²Œì„ì€ Firebase ë¬´ë£Œ í”Œëœìœ¼ë¡œ ìš´ì˜ë©ë‹ˆë‹¤.
                    í•˜ë£¨ ì“°ê¸° í•œë„(20,000íšŒ) ì´ˆê³¼ ì‹œ ì„œë¹„ìŠ¤ê°€ ì¼ì‹œ ì¤‘ì§€ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                  </p>
                  <p className="mt-1">
                    Copyright Â© 2025 The Pixel Legacy Project
                  </p>
                </footer>
              </div>
            </div>
          );
        };

        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>

